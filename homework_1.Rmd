# homework1: join non spatial data to spatial data.

## load library

```{r}
library(sf)
library(tidyverse)
```

## Data loading

-   `st_read`: 加载shp
-   `st_simplify`: 简化shp，dTolerance越大越简化
-   `read_csv`: 加载csv

```{r}
shape <- st_read("data/statsnz-territorial-authority-2018-generalised-SHP/territorial-authority-2018-generalised.shp")

shape_simple <- st_simplify(shape, dTolerance = 1000)

employed_2018 <- read_csv("data/stats_edited.csv")
```

## check data 1 - first few lines

```{r}
head(shape_simple)
head(employed_2018)
```

## check data 2 - statistical summary

## check data 3 - datatype of attributes

- `st_drop_geometry`: 删除空间数据，保留属性数据，这样才能进行后面的summarise_all
- `summarise_all(class)`: 返回每一列的type

```{r}
Datatypelist <- shape_simple %>%
  st_drop_geometry%>% 
  summarise_all(class)

Datatypelist2 <- employed_2018 %>% 
  summarise_all(class)

Datatypelist
Datatypelist2
```

## check data 4 - plot

```{r}
summary(shape_simple)

shape_simple %>%
  st_geometry()%>%
  plot()
```




## Data manipulation

join on the description

```{r}
# join on the description 

shape2 <- shape_simple%>%
  merge(.,
        employed_2018,
        by.x="TA2018_V_1", 
        by.y="Area_Description")
```

Join on the ID by making the column numeric

```{r}


shape3 <- shape_simple %>%
  mutate(TA2018_V1_=(as.numeric(TA2018_V1_)))%>%
  merge(.,
        employed_2018,
        by.x="TA2018_V1_", 
        by.y="Area_Code")

#or 

# shape3 <- shape %>%
#   transform(., TA2018_V1_ = as.numeric(TA2018_V1_))%>%
#   merge(.,
#         employed_2018,
#         by.x="TA2018_V1_", 
#         by.y="Area_Code")

# or also 
#shape$TA2018_V1_ = as.numeric(shape$TA2018_V1_)
```

## Data mapping

```{r}
library(tmap)
tmap_mode("plot")
# change the fill to your column name if different
my_map<-shape2 %>%
  qtm(.,fill = "Paid employee")

my_map
```
